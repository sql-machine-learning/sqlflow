language: go

branches:
  only:
  - gh-pages
  - /.*/

service:
  - docker

stages:
  - codegen
  - test
  - deploy

codegen:
  - ls -lah
  - docker build -t sqlflow:dev -f Dockerfile.dev .
  - docker run --rm -v $GOPATH:/go -w /go/src/github.com/sql-machine-learning/sqlflow sqlflow:dev go generate ./...

test:
  - docker run --rm -v $GOPATH:/go -w /go/src/github.com/sql-machine-learning/sqlflow sqlflow:dev go test -v

deploy:
  - echo "TODO(tony): push nightly release to DockerHub"
